<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistik - Hexenjäger</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="hexenjaeger-symbol"></div>
            <h1>Statistik</h1>
            <p>Übersicht und Auszahlungsstatistik</p>
            <a href="index.html" class="back-btn">← Zurück zur Übersicht</a>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalMembers">0</div>
                <div class="stat-label">Mitglieder</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="openPayouts">0</div>
                <div class="stat-label">Offene Auszahlungen</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalAmount">$0</div>
                <div class="stat-label">Ausstehender Betrag</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedPayouts">0</div>
                <div class="stat-label">Abgeschlossene Auszahlungen</div>
            </div>
        </div>

        <div class="card">
            <h2>Aktuelle Auszahlungen</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Mitglied</th>
                            <th>Betrag</th>
                            <th>Events</th>
                        </tr>
                    </thead>
                    <tbody id="currentPayoutsBody">
                    </tbody>
                </table>
            </div>
            <div id="noCurrentPayouts" class="no-data" style="display: none;">
                Keine offenen Auszahlungen
            </div>
        </div>

        <div class="card">
            <h2>Abgeschlossene Auszahlungen</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Mitglied</th>
                            <th>Betrag</th>
                            <th>Datum</th>
                        </tr>
                    </thead>
                    <tbody id="completedPayoutsBody">
                    </tbody>
                </table>
            </div>
            <div id="noCompletedPayouts" class="no-data" style="display: none;">
                Keine abgeschlossenen Auszahlungen
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        function updateStatistics() {
            const members = db.getMembers();
            const events = db.getEvents();
            const completedPayouts = db.getCompletedPayouts();

            // Summary Statistics
            document.getElementById('totalMembers').textContent = members.length;
            document.getElementById('openPayouts').textContent = events.length;
            document.getElementById('completedPayouts').textContent = completedPayouts.length;
            
            const totalAmount = events.reduce((total, event) => {
                if (['cayo', 'rp_fabrik', 'ekz'].includes(event.eventType)) {
                    return total + (event.totalAmount || 0);
                } else {
                    return total + db.getEventPrice(event.eventType, event.amount || 1);
                }
            }, 0);
            document.getElementById('totalAmount').textContent = formatCurrency(totalAmount);

            // Current Payouts
            const currentPayoutsBody = document.getElementById('currentPayoutsBody');
            const noCurrentPayouts = document.getElementById('noCurrentPayouts');
            
            if (events.length === 0) {
                currentPayoutsBody.innerHTML = '';
                noCurrentPayouts.style.display = 'block';
            } else {
                noCurrentPayouts.style.display = 'none';
                currentPayoutsBody.innerHTML = events.map(event => {
                    const memberNames = event.memberIds.map(id => {
                        const member = members.find(m => m.id === id);
                        return member ? member.name : 'Unbekannt';
                    }).join(', ');
                    
                    const amount = ['cayo', 'rp_fabrik', 'ekz'].includes(event.eventType) 
                        ? formatCurrency(event.totalAmount || 0)
                        : formatCurrency(db.getEventPrice(event.eventType, event.amount || 1));
                    
                    return `
                        <tr>
                            <td>${memberNames}</td>
                            <td>${amount}</td>
                            <td>${event.eventType}</td>
                        </tr>
                    `;
                }).join('');
            }

            // Completed Payouts
            const completedPayoutsBody = document.getElementById('completedPayoutsBody');
            const noCompletedPayouts = document.getElementById('noCompletedPayouts');
            
            if (completedPayouts.length === 0) {
                completedPayoutsBody.innerHTML = '';
                noCompletedPayouts.style.display = 'block';
            } else {
                noCompletedPayouts.style.display = 'none';
                completedPayoutsBody.innerHTML = completedPayouts.map(payout => {
                    const date = new Date(payout.completedDate).toLocaleDateString('de-DE');
                    return `
                        <tr>
                            <td>${payout.memberName}</td>
                            <td>${formatCurrency(payout.total)}</td>
                            <td>${date}</td>
                        </tr>
                    `;
                }).join('');
            }
        }

        document.addEventListener('DOMContentLoaded', updateStatistics);
    </script>
</body>
</html>
