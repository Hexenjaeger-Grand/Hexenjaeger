<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Eingabe - Hexenj√§ger</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .event-specific { display: none; }
        .info-text { 
            color: var(--text-muted); 
            font-size: 12px; 
            margin-top: 5px; 
        }
        
        .amount-preview {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid var(--accent-purple);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .preview-title {
            font-weight: bold;
            color: var(--accent-purple);
            margin-bottom: 8px;
        }
        
        .preview-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        .preview-total {
            font-weight: bold;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 2px solid var(--accent-purple);
        }
        
        .preview-empty {
            color: var(--text-muted);
            font-style: italic;
            text-align: center;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìù Event Eingabe</h1>
            <a href="index.html" class="back-btn">‚Üê Zur√ºck</a>
        </header>

        <div class="event-form">
            <div>
                <label for="eventType">Event Typ</label>
                <select id="eventType">
                    <option value="">Event ausw√§hlen</option>
                    <option value="bizwar_win">Bizwar Win/Kill</option>
                    <option value="bizwar_lose">Bizwar Lose/Kill</option>
                    <option value="40er_win">40er Win/Kill</option>
                    <option value="40er_lose">40er Lose/Kill</option>
                    <option value="ekz">EKZ Win</option>
                    <option value="hafen">Hafen Drop</option>
                    <option value="giesserei">Gie√üerei Kill</option>
                    <option value="waffenfabrik">Waffenfabrik Kill</option>
                    <option value="cayo">Cayo Perico Drop</option>
                    <option value="rp_fabrik">RP Fabrik Win</option>
                </select>
            </div>

            <div>
                <label for="memberSelect">Mitglied</label>
                <select id="memberSelect">
                    <!-- Mitglieder werden hier geladen -->
                </select>
            </div>

            <!-- Normale Events: Kills/Drops -->
            <div id="normalEvent" class="event-specific">
                <label for="amount">Anzahl Kills/Drops</label>
                <input type="number" id="amount" placeholder="z.B. 5 f√ºr 5 Kills">
                <div class="info-text">Das ausgew√§hlte Mitglied erh√§lt den Betrag f√ºr die angegebene Anzahl</div>
            </div>

            <!-- Cayo Perico: Gesamtbetrag und Drops -->
            <div id="cayoEvent" class="event-specific">
                <label for="cayoDrops">Anzahl eingenommene Drops/Zones</label>
                <input type="number" id="cayoDrops" placeholder="Anzahl Drops">
                <label for="cayoTotalAmount">Gesamtbetrag ($)</label>
                <input type="number" id="cayoTotalAmount" placeholder="z.B. 1000000 f√ºr 1 Million">
                <div class="info-text">Der Betrag wird auf alle Teilnehmer aufgeteilt</div>
            </div>

            <!-- RP Fabrik: Gesamtbetrag -->
            <div id="rpEvent" class="event-specific">
                <label for="rpTotalAmount">Gesamtbetrag ($)</label>
                <input type="number" id="rpTotalAmount" placeholder="z.B. 8000000 f√ºr 8 Millionen">
                <div class="info-text">Der Betrag wird auf alle Teilnehmer aufgeteilt</div>
            </div>

            <button id="submitEvent" class="btn-primary">Event speichern</button>
            <div id="statusMessage" style="margin-top: 15px;"></div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Vereinfachte Event-Eingabe ohne Mehrfachauswahl
        document.addEventListener('DOMContentLoaded', function() {
            const eventType = document.getElementById('eventType');
            const memberSelect = document.getElementById('memberSelect');
            const normalEvent = document.getElementById('normalEvent');
            const cayoEvent = document.getElementById('cayoEvent');
            const rpEvent = document.getElementById('rpEvent');
            const submitBtn = document.getElementById('submitEvent');
            const statusMessage = document.getElementById('statusMessage');

            // F√ºlle Mitglieder Select
            function loadMembers() {
                const members = JSON.parse(localStorage.getItem('hexenjaeger_members') || '[]');
                
                if (members.length === 0) {
                    memberSelect.innerHTML = '<option value="">Keine Mitglieder vorhanden</option>';
                    return;
                }
                
                memberSelect.innerHTML = '<option value="">Mitglied ausw√§hlen</option>' +
                    members.map(m => `<option value="${m.id}">${m.name} (${m.id})</option>`).join('');
            }

            // Event Type Change
            eventType.addEventListener('change', function() {
                // Verstecke alle Event-spezifischen Felder
                normalEvent.style.display = 'none';
                cayoEvent.style.display = 'none';
                rpEvent.style.display = 'none';

                // Zeige die richtigen Felder
                switch(this.value) {
                    case 'cayo':
                        cayoEvent.style.display = 'block';
                        break;
                    case 'rp_fabrik':
                        rpEvent.style.display = 'block';
                        break;
                    case '':
                        break;
                    default:
                        normalEvent.style.display = 'block';
                        break;
                }
            });

            // Submit Event
            submitBtn.addEventListener('click', function() {
                const eventTypeValue = eventType.value;
                const memberId = memberSelect.value;
                
                // Validierung
                if (!eventTypeValue) {
                    showStatus('Bitte w√§hle einen Event-Typ aus!', 'error');
                    return;
                }

                if (!memberId) {
                    showStatus('Bitte w√§hle ein Mitglied aus!', 'error');
                    return;
                }

                // Sammle Event-Daten
                let eventData = {
                    eventType: eventTypeValue,
                    memberId: memberId
                };

                // F√ºge typspezifische Daten hinzu
                switch(eventTypeValue) {
                    case 'cayo':
                        const cayoDrops = parseInt(document.getElementById('cayoDrops').value) || 0;
                        const cayoTotal = parseInt(document.getElementById('cayoTotalAmount').value) || 0;
                        
                        if (!cayoDrops || !cayoTotal) {
                            showStatus('Bitte f√ºlle alle Felder f√ºr Cayo Perico aus!', 'error');
                            return;
                        }
                        
                        eventData.amount = cayoDrops;
                        eventData.totalAmount = cayoTotal;
                        break;

                    case 'rp_fabrik':
                        const rpTotal = parseInt(document.getElementById('rpTotalAmount').value) || 0;
                        
                        if (!rpTotal) {
                            showStatus('Bitte gib den Gesamtbetrag f√ºr RP Fabrik ein!', 'error');
                            return;
                        }
                        
                        eventData.amount = 1;
                        eventData.totalAmount = rpTotal;
                        break;

                    default:
                        const amount = parseInt(document.getElementById('amount').value) || 0;
                        
                        if (!amount) {
                            showStatus('Bitte gib die Anzahl Kills/Drops ein!', 'error');
                            return;
                        }
                        
                        eventData.amount = amount;
                        break;
                }

                // Nutze die Haupt-DB aus app.js
                const result = db.addEvent(eventData);
                
                if (result.success) {
                    showStatus(`Event erfolgreich gespeichert! Betrag: ${formatCurrency(result.calculatedAmount)}`, 'success');
                    resetForm();
                } else {
                    showStatus('Fehler: ' + result.error, 'error');
                }
            });

            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.style.color = type === 'success' ? '#10b981' : '#ef4444';
                statusMessage.style.fontWeight = 'bold';

                setTimeout(() => {
                    statusMessage.textContent = '';
                }, 5000);
            }

            function resetForm() {
                eventType.value = '';
                memberSelect.value = '';
                document.getElementById('amount').value = '';
                document.getElementById('cayoDrops').value = '';
                document.getElementById('cayoTotalAmount').value = '';
                document.getElementById('rpTotalAmount').value = '';
                
                normalEvent.style.display = 'none';
                cayoEvent.style.display = 'none';
                rpEvent.style.display = 'none';
            }

            // Initialisierung
            loadMembers();
        });
    </script>
</body>
</html>
