<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Eingabe - Hexenjäger</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="hexenjaeger-symbol"></div>
            <h1>Event Eingabe</h1>
            <p>Schnelle Erfassung für mehrere Mitglieder</p>
            <a href="index.html" class="back-btn">← Zurück zur Übersicht</a>
        </header>

        <div class="card">
            <h2>Neues Event erfassen</h2>
            
            <div class="event-form">
                <div class="form-group">
                    <label for="eventType">Event Typ</label>
                    <select id="eventType">
                        <option value="">-- Event auswählen --</option>
                        <option value="bizwar_win">Bizwar Win</option>
                        <option value="bizwar_lose">Bizwar Lose</option>
                        <option value="40er_win">40er Win</option>
                        <option value="40er_lose">40er Lose</option>
                        <option value="ekz">EKZ</option>
                        <option value="hafen">Hafen</option>
                        <option value="giesserei">Gießerei</option>
                        <option value="waffenfabrik">Waffenfabrik</option>
                        <option value="cayo">Cayo Perico</option>
                        <option value="rp_fabrik">RP Fabrik</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Mitglieder auswählen</label>
                    <div class="quick-actions">
                        <button type="button" class="quick-btn" onclick="selectAllMembers()">Alle auswählen</button>
                        <button type="button" class="quick-btn" onclick="deselectAllMembers()">Alle abwählen</button>
                    </div>
                    <div class="members-grid" id="membersGrid"></div>
                </div>

                <div class="form-group" id="amountSection" style="display: none;">
                    <label for="amount">Anzahl</label>
                    <input type="number" id="amount" min="1" value="1">
                </div>

                <div class="form-group" id="totalAmountSection" style="display: none;">
                    <label for="totalAmount">Gesamtbetrag ($)</label>
                    <input type="number" id="totalAmount" min="1" placeholder="Gesamtbetrag eingeben">
                </div>

                <div style="display: flex; gap: 12px; margin-top: 25px;">
                    <button id="submitEvent" class="btn btn-primary" style="flex: 1;">Event speichern</button>
                    <button type="button" onclick="resetForm()" class="btn btn-secondary">Zurücksetzen</button>
                </div>
                
                <div id="statusMessage" style="margin-top: 15px; text-align: center; display: none;"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        let selectedMembers = [];

        function loadMembers() {
            const members = db.getMembers();
            const membersGrid = document.getElementById('membersGrid');
            
            membersGrid.innerHTML = members.map(member => `
                <div class="member-tag" data-id="${member.id}">
                    <input type="checkbox" id="member_${member.id}" style="display: none;">
                    <span>${member.name}</span>
                    <small>(${member.id})</small>
                </div>
            `).join('');

            membersGrid.querySelectorAll('.member-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    const memberId = this.dataset.id;
                    const checkbox = this.querySelector('input');
                    
                    if (checkbox.checked) {
                        checkbox.checked = false;
                        this.classList.remove('selected');
                        selectedMembers = selectedMembers.filter(id => id !== memberId);
                    } else {
                        checkbox.checked = true;
                        this.classList.add('selected');
                        selectedMembers.push(memberId);
                    }
                });
            });
        }

        function selectAllMembers() {
            const members = db.getMembers();
            selectedMembers = members.map(m => m.id);
            
            document.querySelectorAll('.member-tag').forEach(tag => {
                tag.classList.add('selected');
                tag.querySelector('input').checked = true;
            });
        }

        function deselectAllMembers() {
            selectedMembers = [];
            document.querySelectorAll('.member-tag').forEach(tag => {
                tag.classList.remove('selected');
                tag.querySelector('input').checked = false;
            });
        }

        function resetForm() {
            document.getElementById('eventType').value = '';
            document.getElementById('amount').value = '1';
            document.getElementById('totalAmount').value = '';
            document.getElementById('amountSection').style.display = 'none';
            document.getElementById('totalAmountSection').style.display = 'none';
            deselectAllMembers();
        }

        function showStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.style.color = type === 'success' ? '#10b981' : '#ef4444';
            statusElement.style.display = 'block';
            setTimeout(() => statusElement.style.display = 'none', 4000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const eventType = document.getElementById('eventType');
            const submitBtn = document.getElementById('submitEvent');

            loadMembers();

            eventType.addEventListener('change', function() {
                const amountSection = document.getElementById('amountSection');
                const totalAmountSection = document.getElementById('totalAmountSection');
                
                if (this.value) {
                    amountSection.style.display = 'block';
                    
                    if (['cayo', 'rp_fabrik'].includes(this.value)) {
                        totalAmountSection.style.display = 'block';
                    } else {
                        totalAmountSection.style.display = 'none';
                    }
                } else {
                    amountSection.style.display = 'none';
                    totalAmountSection.style.display = 'none';
                }
            });

            submitBtn.addEventListener('click', function() {
                if (!eventType.value) {
                    showStatus('Bitte Event-Typ auswählen', 'error');
                    return;
                }

                if (selectedMembers.length === 0) {
                    showStatus('Bitte Mitglieder auswählen', 'error');
                    return;
                }

                const eventTypeValue = eventType.value;
                const amount = parseInt(document.getElementById('amount').value) || 1;
                const totalAmount = parseInt(document.getElementById('totalAmount').value) || 0;

                if (['cayo', 'rp_fabrik'].includes(eventTypeValue) && totalAmount === 0) {
                    showStatus('Bitte Gesamtbetrag eingeben', 'error');
                    return;
                }

                const eventData = {
                    eventType: eventTypeValue,
                    memberIds: selectedMembers,
                    amount: amount,
                    totalAmount: totalAmount
                };

                const result = db.addEvent(eventData);
                if (result.success) {
                    showStatus(`Event für ${selectedMembers.length} Mitglieder gespeichert!`, 'success');
                    resetForm();
                } else {
                    showStatus('Fehler: ' + result.error, 'error');
                }
            });
        });
    </script>
</body>
</html>
